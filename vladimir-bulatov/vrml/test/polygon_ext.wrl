#VRML V2.0 utf8

PROTO Polygon [
field MFVec3f vertices []
eventIn MFVec3f set_vertices 
eventOut SFBool isReady
] {

    DEF IFS IndexedFaceSet {
	solid FALSE
	convex FALSE
	coordIndex []
	coord Coordinate {
	    point []
	}
    }
    
    DEF Polygon Script {

	directOutput TRUE

	eventOut SFBool isReady IS isReady
	eventIn MFVec3f set_vertices IS set_vertices 
	field SFNode ifs USE IFS
	field MFVec3f vertices IS vertices

	field MFInt32 ci []
	field MFVec3f vertex []

	
	field MFInt32 ci10_1 [0,1,2,3,4,5,6,7,8,9,-1]
	field MFInt32 ci10_2 [
		       1,0,10,-1,
		       3,2,11,-1,
		       5,4,12,-1,
		       7,6,13,-1,
		       9,8,14,-1,
		       10,11,12,13,14,-1]  
	field MFInt32 ci10_3 [
	               10,11,12,13,14,-1,
		       10,16,30,20,15,-1,
		       11,15,34,24,19,-1,
		       12,19,33,23,18,-1,
		       13,18,32,22,17,-1,
		       14,17,31,21,16,-1,  
		       3,25,20,-1,
		       8,30,26,-1,
		       1,26,21,-1,
		       6,31,27,-1,
		       9,27,22,-1,
		       4,32,28,-1,
		       7,28,23,-1,
		       2,33,29,-1,
		       5,29,24,-1,
		       0,34,25,-1]
  
	field MFInt32   ci10_4 [
		       3,25,20,-1,
		       8,30,26,-1,
		       1,26,21,-1,
		       6,31,27,-1,
		       9,27,22,-1,
		       4,32,28,-1,
		       7,28,23,-1,
		       2,33,29,-1,
		       5,29,24,-1,
		       0,34,25,-1,
		       
		       18,30,20,-1,
		       19,31,21,-1,
		       15,32,22,-1,
		       16,33,23,-1,
		       17,34,24,-1,
		       
		       15,11,10,-1,
		       16,10,14,-1,
		       17,14,13,-1,
		       18,13,12,-1,
		       19,12,11,-1]
  
	field MFInt32   ci10_5 [
		       3,25,30,18,-1,
		       1,26,31,19,-1,
		       9,27,32,15,-1,
		       7,28,33,16,-1,
		       5,29,34,17,-1,
		       8,26,20,18,-1,
		       6,27,21,19,-1,
		       4,28,22,15,-1,
		       2,29,23,16,-1,
		       0,25,24,17,-1,
		       
		       13,12,20,30,-1,
		       12,11,21,31,-1,
		       11,10,22,32,-1,
		       10,14,23,33,-1,
		       14,13,24,34,-1]
  
	field MFInt32   ci10_7 [
		       6,5,15,-1,
		       2,1,16,-1,
		       8,7,17,-1,
		       4,3,18,-1,
		       0,9,19,-1,		       
		       15,11,10,-1,
		       16,12,11,-1,
		       17,13,12,-1,
		       18,14,13,-1,
		       19,10,14,-1]
  
	field MFInt32   ci10_8 [
		       10,11,12,13,14,-1,
		       8,7,15,10,19,-1,
		       4,3,16,11,15,-1,
		       0,9,17,12,16,-1,
		       6,5,18,13,17,-1,
		       2,1,19,14,18,-1]
  
	field MFInt32   ci10_9 [
		       10,11,12,13,14,-1,  
		       20,10,30,-1,
		       21,14,31,-1,
		       22,13,32,-1,
		       23,12,33,-1,
		       24,11,34,-1,
		       4,25,20,-1,
		       8,26,21,-1,
		       2,27,22,-1,
		       6,28,23,-1,
		       0,29,24,-1,
  
		       7,34,25,-1,
		       1,30,26,-1,
		       5,31,27,-1,
		       9,32,28,-1,
		       3,33,29,-1
		       ]

	field MFInt32   ci10_10 [
			20,30,24,34,23,33,22,32,21,31,-1,  
			4,25,30,10,-1,
			8,26,31,14,-1,
			2,27,32,13,-1,
			6,28,33,12,-1,
			0,29,34,11,-1, 
			7,11,24,25,-1,
			1,10,20,26,-1,
			5,14,21,27,-1,
			9,13,22,28,-1,
			3,12,23,29,-1
			]
  
	field MFInt32   ci10_6 [             
                       5, 6, 11, 10, -1,
		       1, 2, 12, 11, -1,
		       7, 8, 13, 12, -1,
		       3, 4, 14, 13, -1,
		       9, 0, 10, 14, -1]


	field MFInt32     ci8_0 [
		      0,8,11,3,-1, 
		      4,9,8,7,-1,
		      2,10,9,1,-1, 
		      6,11,10,5,-1]

	field MFInt32  ci8_1 [0,1,2,3,4,5,6,7,-1]

	field MFInt32  ci8_2 [
		      8,9,10,11,-1,
		      0,1,8,-1,
		      6,7,9,-1,
		      4,5,10,-1,
		      2,3,11,-1]

	field MFInt32  ci8_3 [
		      8,9,10,11,-1,  
		      13,11,21,-1,
		      14,10,22,-1,
		      15,9,23,-1,  
		      12,8,20,-1,
		      7,20,17,-1,
		      4,17,13,-1,
		      1,21,18,-1,
		      6,18,14,-1,
		      3,22,19,-1,
		      0,19,15,-1,
		      5,23,16,-1,
		      2,16,12,-1]

	field MFInt32  ci8_4 [
		      12,20,15,23,
		      14,22,13,21,-1,
		      2,16,20,8,-1,
		      7,8 ,12,17,-1,
		      4,17,21,11,-1,
		      1,11,13,18,-1,
		      6,18,22,10,-1,
		      3,10,14,19,-1,
		      0,19,23,9,-1,
		      5,9,15,16,-1]
	
	url [
	"polygon1.js"
	# "PolygonNode.class"
	]	
    }
}

Transform {
    children [ 
    Transform {
	translation 0 0 0.5
	children [
	Shape {
	    geometry DEF POLY Polygon {
		vertices [2 0 0 , -1 1 0, 1 -1 0, 1 1 0]
	    }
	    appearance Appearance {
		material Material {
		    diffuseColor 1 0.5 0.3
		    ambientIntensity 0.5
		}
	    }
	}
	]
    }
    Transform {
	translation 0 0 -0.5
	children [
	Shape {
	    geometry DEF POLY1 Polygon {
		vertices [2 0 0 , -1 1 0, 1 -1 0, 1 1 0]
	    }
	    appearance Appearance {
		material Material {
		    diffuseColor  0.3  0.5 1.0
		    ambientIntensity 0.5
		}
	    }
	}
	]
    }
    ]
}

NavigationInfo {
	type "EXAMINE"
	headlight TRUE
}


DEF TIMER TimeSensor {
    loop TRUE
    cycleInterval 50
    enabled TRUE
}

DEF SCRIPT Script {
    directOutput TRUE 

    eventIn SFFloat set_fraction
    eventIn SFTime start

    field SFNode poly USE POLY
    field SFNode poly1 USE POLY1
    field SFInt32 order 4
    field SFInt32 skip 1
    field SFNode timer USE TIMER

    url [
    "javascript:
    function initialize(){
	rot = new MFRotation();
	for(var i = 0; i < order; i++){
	    rot[i] = new SFRotation(0,0,1,skip*i*Math.PI*2/order);
	}
    }

    function start(v,t){
	if(timer.enabled){
	    timer.set_enabled = false;
	} else {
	    timer.set_enabled = true;
	}
    }

    function set_fraction(v,t){
	/*
	if(poly.isReady == false){
	    trace(poly.isReady);
	    return;
	}
	*/
	//trace(poly.isReady);
	//timer.set_enabled = false;
	//return;
	vert = new MFVec3f();
	
	f = v*2*Math.PI;
	
	vert[0] = new SFVec3f(Math.cos(f), Math.sin(f),0);
	vert[2*order-1] = new SFVec3f(vert[0].x, -vert[0].y, vert[0].z);
	
	for(var i = 1; i < order; i++){
	    vert[2*i-1] = rot[i].multVec(vert[2*order-1]);
	    vert[2*i] = rot[i].multVec(vert[0]);	    
	}
	poly.set_vertices = vert;
	var vert1 = new MFVec3f();
	vert1[0] = new SFVec3f(Math.cos(f), Math.sin(f),0);
	vert1[2*order-1] = new SFVec3f(vert1[0].x, -vert1[0].y, vert1[0].z);
	for(var i = 1; i < order; i++){
	    vert1[2*i-1] = rot[(2*i)%order].multVec(vert[2*order-1]);
	    vert1[2*i] = rot[(2*i)%order].multVec(vert[0]);	    
	}
	poly1.set_vertices = vert1;
    }
    "
    ]
}

ROUTE TIMER.fraction_changed TO SCRIPT.set_fraction

Group {
    children [
    DEF TS TouchSensor {
    }
    Shape {
	geometry Sphere {
	    radius 0.1
	}
	appearance Appearance {
	    material Material {
		diffuseColor 1 0 1
	    }
	}
    }
    ]
}
ROUTE TS.touchTime TO SCRIPT.start
Viewpoint {
    position 0 0 3
}
